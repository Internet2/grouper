<?xml version="1.0" encoding="UTF-8"?>
<AttributeResolver
  xmlns="urn:mace:shibboleth:2.0:resolver"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:resolver="urn:mace:shibboleth:2.0:resolver"
  xmlns:ad="urn:mace:shibboleth:2.0:resolver:ad"
  xmlns:dc="urn:mace:shibboleth:2.0:resolver:dc"
  xmlns:grouper="http://grouper.internet2.edu/shibboleth/2.0"
  xsi:schemaLocation="
   urn:mace:shibboleth:2.0:resolver classpath:/schema/shibboleth-2.0-attribute-resolver.xsd
   urn:mace:shibboleth:2.0:resolver:dc classpath:/schema/shibboleth-2.0-attribute-resolver-dc.xsd
   urn:mace:shibboleth:2.0:resolver:ad classpath:/schema/shibboleth-2.0-attribute-resolver-ad.xsd
   http://grouper.internet2.edu/shibboleth/2.0 classpath:/schema/shibboleth-2.0-grouper.xsd">

  <!-- group data connector -->

  <resolver:DataConnector id="group" xsi:type="grouper:GroupDataConnector">
    <grouper:Attribute id="members" />
    <grouper:Attribute id="members:immediate" />
    <!--  <grouper:Attribute id="members:immediate:fieldA" /> -->
    <grouper:Attribute id="groups" />
    <grouper:Attribute id="admins" />
  </resolver:DataConnector>

  <!-- stem data connector -->

  <resolver:DataConnector id="stem" xsi:type="grouper:StemDataConnector">
  </resolver:DataConnector>
  
  <resolver:AttributeDefinition id="stem-objectclass" xsi:type="ad:Simple">
    <resolver:Dependency ref="static" />
  </resolver:AttributeDefinition>

  <!--  stem dn should never be flat -->
  <resolver:AttributeDefinition id="stemDn-ad-prod" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="name" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="stem" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="stemDn-ad-test" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="stem" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="stemDn-openldap-prod" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="stem" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="stemDn-openldap-test" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="stem" />
  </resolver:AttributeDefinition>

  <!-- target specific identifiers -->

  <resolver:AttributeDefinition id="groupDn-ad-prod" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="group" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="groupDn-ad-test" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="group" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="groupDn-openldap-prod" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="group" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="groupDn-openldap-test" xsi:type="grouper:LdapDnPSOIdentifier"
    structure="flat" sourceAttributeID="extension" rdnAttributeName="cn" base="ou=groups,dc=grouper,dc=edu">
    <resolver:Dependency ref="group" />
  </resolver:AttributeDefinition>

  <!--  target specific objectclasses -->

  <resolver:AttributeDefinition id="ad-objectclass" xsi:type="ad:Simple">
    <resolver:Dependency ref="static" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="openldap-objectclass" xsi:type="ad:Simple">
    <resolver:Dependency ref="static" />
  </resolver:AttributeDefinition>

  <!-- common group attributes -->

  <resolver:AttributeDefinition id="admins" xsi:type="grouper:Subject">
    <resolver:Dependency ref="group" />
    <grouper:Attribute id="subjectId" source="jdbc" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="cn" xsi:type="ad:Simple" sourceAttributeID="extension">
    <resolver:Dependency ref="group" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="description" xsi:type="ad:Simple">
    <resolver:Dependency ref="group" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="groupIsMemberOf" xsi:type="grouper:Group"
    sourceAttributeID="groups">
    <resolver:Dependency ref="group" />
    <grouper:Attribute id="name" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="hasMember" xsi:type="grouper:Member" sourceAttributeID="members">
    <resolver:Dependency ref="group" />
    <grouper:Attribute id="lfname" source="jdbc" />
    <grouper:Attribute id="name" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="members-jdbc" xsi:type="grouper:Member"
    sourceAttributeID="members">
    <resolver:Dependency ref="group" />
    <grouper:Attribute id="subjectId" source="jdbc" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="members-g:gsa" xsi:type="grouper:Member"
    sourceAttributeID="members">
    <resolver:Dependency ref="group" />
    <grouper:Attribute id="name" source="g:gsa" />
  </resolver:AttributeDefinition>

  <!-- member data connector -->

  <resolver:AttributeDefinition id="memberIsAdminOf" xsi:type="grouper:Group"
    sourceAttributeID="admins">
    <resolver:Dependency ref="member" />
    <grouper:Attribute id="name" />
  </resolver:AttributeDefinition>

  <resolver:AttributeDefinition id="memberIsMemberOf" xsi:type="grouper:Group"
    sourceAttributeID="groups">
    <resolver:Dependency ref="member" />
    <grouper:Attribute id="name" />
  </resolver:AttributeDefinition>

  <resolver:DataConnector id="member" xsi:type="grouper:MemberDataConnector">
    <grouper:Attribute id="groups" />
  </resolver:DataConnector>

  <!-- static data connector -->

  <resolver:DataConnector id="static" xsi:type="dc:Static">
    <dc:Attribute id="ad-objectclass">
      <dc:Value>top</dc:Value>
      <dc:Value>group</dc:Value>
    </dc:Attribute>
    <dc:Attribute id="openldap-objectclass">
      <dc:Value>top</dc:Value>
      <dc:Value>eduMember</dc:Value>
      <dc:Value>groupOfNames</dc:Value>
    </dc:Attribute>
    <dc:Attribute id="stem-objectclass">
      <dc:Value>top</dc:Value>
      <dc:Value>organizationalUnit</dc:Value>
    </dc:Attribute>
  </resolver:DataConnector>

  <!-- ad-prod target identifier -->

  <resolver:AttributeDefinition id="memberDn-ad-prod" xsi:type="ad:Simple" sourceAttributeID="identifier">
    <resolver:Dependency ref="ad-prod.DataConnector" />
  </resolver:AttributeDefinition>

  <resolver:DataConnector id="ad-prod.DataConnector" provider="provider-ad-prod" xsi:type="grouper:SPMLDataConnector"
    scope="subTree" base="ou=people,dc=grouper,dc=edu" returnData="identifier">
    <resolver:Dependency ref="member" />
    <grouper:FilterTemplate>(uid=${subjectId.get(0)})</grouper:FilterTemplate>
  </resolver:DataConnector>

  <!-- ad-test target identifier -->

  <resolver:AttributeDefinition id="memberDn-ad-test" xsi:type="ad:Simple" sourceAttributeID="identifier">
    <resolver:Dependency ref="ad-test.DataConnector" />
  </resolver:AttributeDefinition>

  <resolver:DataConnector id="ad-test.DataConnector" provider="provider-ad-test" xsi:type="grouper:SPMLDataConnector"
    scope="subTree" base="ou=people,dc=grouper,dc=edu" returnData="identifier">
    <resolver:Dependency ref="member" />
    <grouper:FilterTemplate>(uid=${subjectId.get(0)})</grouper:FilterTemplate>
  </resolver:DataConnector>

  <!-- openldap-prod target identifier -->

  <resolver:AttributeDefinition id="memberDn-openldap-prod" xsi:type="ad:Simple" sourceAttributeID="identifier">
    <resolver:Dependency ref="openldap-prod.DataConnector" />
  </resolver:AttributeDefinition>

  <resolver:DataConnector id="openldap-prod.DataConnector" provider="provider-openldap-prod"
    xsi:type="grouper:SPMLDataConnector" scope="subTree" base="ou=people,dc=grouper,dc=edu" returnData="identifier">
    <resolver:Dependency ref="member" />
    <grouper:FilterTemplate>(uid=${subjectId.get(0)})</grouper:FilterTemplate>
  </resolver:DataConnector>

  <!-- openldap-test target identifier -->

  <resolver:AttributeDefinition id="memberDn-openldap-test" xsi:type="ad:Simple" sourceAttributeID="identifier" >
    <resolver:Dependency ref="openldap-test.DataConnector" />
  </resolver:AttributeDefinition>

  <resolver:DataConnector id="openldap-test.DataConnector" provider="provider-openldap-test"
    xsi:type="grouper:SPMLDataConnector" scope="subTree" base="ou=people,dc=grouper,dc=edu" returnData="identifier">
    <resolver:Dependency ref="member" />
    <grouper:FilterTemplate>(uid=${subjectId.get(0)})</grouper:FilterTemplate>
  </resolver:DataConnector>
  
</AttributeResolver>