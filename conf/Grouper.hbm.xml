<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping
    PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd">

<hibernate-mapping package="edu.internet2.middleware.grouper">

  <class name="GrouperAttribute" table="grouper_attribute" mutable="true">
    <composite-id access="field">
      <key-property name="groupKey"   type="string" column="groupKey"/>
      <key-property name="groupField" type="string" column="groupField"/>
    </composite-id>
    <property name="groupFieldValue" type="string"/>
  </class>

  <class name="GrouperField" table="grouper_field" mutable="false">
    <cache usage="read-only"/>
    <id name="groupField" type="string" unsaved-value="null" >
      <generator class="assigned"/>
    </id>
    <property name="readPriv"   type="string" not-null="true"/>
    <property name="writePriv"  type="string" not-null="true"/>
    <property name="isList"     type="string" not-null="true"/>
  </class>

  <class name="GrouperGroup" table="grouper_group" mutable="true">
    <id name="groupKey" type="string" unsaved-value="null">
      <generator class="assigned"/>
    </id>
    <property name="groupID"        type="string" not-null="true"/>
    <property name="createTime"     type="string"/>
    <property name="createSubject"  type="string"/>
    <property name="createSource"   type="string"/>
    <property name="modifyTime"     type="string"/>
    <property name="modifySubject"  type="string"/>
    <property name="modifySource"   type="string"/>
    <property name="groupComment"   type="string"/>
  </class>

  <class name="GrouperList" table="grouper_list" mutable="true">
    <composite-id access="field">
      <key-property name="groupKey"   type="string" column="groupKey"/>
      <key-property name="groupField" type="string" column="groupField"/>
      <key-property name="memberKey"  type="string" column="memberKey"/>
      <key-property name="via"        type="string" column="via"/>
    </composite-id>
    <property name="removeAfter">
      <column name="removeAfter" length="255"/>
    </property>
  </class>

  <class name="GrouperMember" table="grouper_member">
    <id name="memberKey" type="string" unsaved-value="null">
      <generator class="assigned"/>
    </id>
    <property name="memberID"       type="string"/>
    <property name="subjectID"      type="string"/>
    <property name="subjectTypeID"  type="string"/>
  </class>

  <class name="GrouperSchema" table="grouper_schema" mutable="true">
    <composite-id access="field">
      <key-property name="groupKey"   type="string" column="groupKey"/>
      <key-property name="groupType"  type="string" column="groupType"/>
    </composite-id>
  </class>

  <class name="GrouperSession" table="grouper_session">
    <id name="sessionID" type="string" unsaved-value="null" >
      <generator class="assigned"/>
    </id>
    <property name="memberID"   type="string" not-null="true"/>
    <property name="startTime"  type="string" not-null="true"/>
  </class>

  <class name="GrouperSubjectAttribute" table="grouper_SubjectAttribute">
    <composite-id access="field">
      <key-property name="subjectID"     type="string" column="subjectID"/>
      <key-property name="subjectTypeID" type="string" column="subjectTypeID"/>
    </composite-id> 
    <property name="name"         type="string" not-null="true"/>
    <property name="instance"     type="integer"/>
    <property name="value"        type="string" not-null="true"/>
    <property name="searchValue"  type="string" not-null="true"/>
  </class>

  <class name="GrouperType" table="grouper_type" mutable="false">
    <cache usage="read-only"/>
    <id name="groupType" type="string" unsaved-value="null" >
      <generator class="assigned"/>
    </id>
  </class>

  <class name="GrouperTypeDef" table="grouper_typeDef" mutable="false">
    <cache usage="read-only"/>
    <composite-id access="field">
      <key-property name="groupType"  type="string" column="groupType"/>
      <key-property name="groupField" type="string" column="groupField"/>
    </composite-id>
  </class>

  <class name="SubjectImpl" table="grouper_subject">
    <id name="subjectID" type="string" unsaved-value="null" >
      <generator class="assigned"/>
    </id>
    <property name="subjectTypeID">
      <column name="subjectTypeID" sql-type="char(255)" not-null="true"/>
    </property>
  </class>

  <class name="SubjectTypeImpl" table="grouper_subjectType" mutable="false">
    <cache usage="read-only"/>
    <id name="subjectTypeID" type="string" unsaved-value="null">
      <generator class="assigned"/>
    </id>
    <property name="name"         type="string" not-null="true"/>
    <property name="adapterClass" type="string" not-null="true"/>
  </class>

  <class name="ViaElement"  table="grouper_viaElement">
    <!-- TODO I suspect this is all wrong -->
    <composite-id access="field">
      <key-property name="pathKey"  type="string"   column="pathKey"/>
      <key-property name="pathIdx"  type="integer"  column="pathIdx"/>
      <key-property name="groupKey" type="string"   column="groupKey"/>
    </composite-id>
  </class>

  <class name="ViaPath" table="grouper_viaPath" mutable="true">
    <!-- TODO I suspect this is all wrong -->
    <id name="pathKey" type="string" unsaved-value="null">
      <generator class="assigned"/>
    </id>
    <list name="elements" table="grouper_viaElement">
      <key    column="pathKey"/>
      <index  column="pathIdx"/>
      <composite-element class="ViaElement"/>
    </list>
  </class>

  <query name="GrouperAttribute.by.extension"><![CDATA[
    from GrouperAttribute           where 
      groupField      = 'extension' and
      groupFieldValue = ?
  ]]></query>

  <query name="GrouperAttribute.by.key"><![CDATA[
    from GrouperAttribute where groupKey = ?
  ]]></query>

  <query name="GrouperAttribute.by.key.and.value"><![CDATA[
    from GrouperAttribute where 
      groupKey    = ?     and
      groupField  = ?
  ]]></query>

  <query name="GrouperAttribute.by.name"><![CDATA[
    from GrouperAttribute      where 
      groupField      = 'name' and
      groupFieldValue = ?
  ]]></query>

  <query name="GrouperAttribute.by.stem"><![CDATA[
    from GrouperAttribute      where 
      groupField      = 'stem' and
      groupFieldValue = ?
  ]]></query>

  <query name="GrouperField.all"><![CDATA[
    from GrouperField
  ]]></query>

  <query name="GrouperGroup.by.created.after"><![CDATA[
    from GrouperGroup where createTime > ?
  ]]></query>

  <query name="GrouperGroup.by.created.before"><![CDATA[
    from GrouperGroup where createTime < ?
  ]]></query>

  <query name="GrouperGroup.by.id"><![CDATA[
    from GrouperGroup where groupID = ?
  ]]></query>

  <query name="GrouperGroup.by.modified.after"><![CDATA[
    from GrouperGroup where modifyTime > ?
  ]]></query>

  <query name="GrouperGroup.by.modified.before"><![CDATA[
    from GrouperGroup where modifyTime < ?
  ]]></query>

  <query name="GrouperList.by.group.and.list"><![CDATA[
    from GrouperList          where
      groupKey    = ?         and
      memberKey   is not null and
      groupField  = ?
  ]]></query>

  <query name="GrouperList.by.group.and.member.and.list.and.is.eff"><![CDATA[
    from GrouperList          where
      groupKey    = ?         and
      memberKey   = ?         and
      groupField  = ?         and
      via         is not null 
  ]]></query>

  <query name="GrouperList.by.group.and.member.and.list.and.is.imm"><![CDATA[
    from GrouperList          where
      groupKey    = ?         and
      memberKey   = ?         and
      groupField  = ?         and
      via         is null 
  ]]></query>

  <query name="GrouperList.by.group.and.list.and.is.eff"><![CDATA[
    from GrouperList          where
      groupKey    = ?         and
      memberKey   is not null and
      groupField  = ?         and
      via         is not null 
  ]]></query>

  <query name="GrouperList.by.group.and.list.and.is.imm"><![CDATA[
    from GrouperList          where
      groupKey    = ?         and
      memberKey   is not null and
      groupField  = ?         and
      via         is null 
  ]]></query>

  <query name="GrouperList.by.list"><![CDATA[
    from GrouperList          where
      groupKey    is not null and
      memberKey   is not null and
      groupField  = ?
  ]]></query>

  <query name="GrouperList.by.list.and.is.eff"><![CDATA[
    from GrouperList          where
      groupKey    is not null and
      memberKey   is not null and
      groupField  = ?         and
      via         is not null 
  ]]></query>

  <query name="GrouperList.by.list.and.is.imm"><![CDATA[
    from GrouperList          where
      groupKey    is not null and
      memberKey   is not null and
      groupField  = ?         and
      via         is null 
  ]]></query>

  <query name="GrouperList.by.member.and.list"><![CDATA[
    from GrouperList          where
      groupKey    is not null and
      memberKey   = ?         and
      groupField  = ?
  ]]></query>

  <query name="GrouperList.by.member.and.list.and.is.eff"><![CDATA[
    from GrouperList          where
      groupKey    is not null and
      memberKey   = ?         and
      groupField  = ?         and
      via         is not null 
  ]]></query>

  <query name="GrouperList.by.member.and.list.and.is.imm"><![CDATA[
    from GrouperList          where
      groupKey    is not null and
      memberKey   = ?         and
      groupField  = ?         and
      via         is null 
  ]]></query>

  <query name="GrouperMember.by.id"><![CDATA[
    from GrouperMember where memberID = ?
  ]]></query>

  <query name="GrouperMember.by.subjectid.and.typeid"><![CDATA[
    from GrouperMember  where 
      subjectID     = ? and
      subjectTypeID = ?
  ]]></query>

  <query name="GrouperSchema.by.key"><![CDATA[
    from GrouperSchema where groupKey = ?
  ]]></query>

  <query name="GrouperSchema.by.type"><![CDATA[
    from GrouperSchema where groupType = ?
  ]]></query>

  <query name="GrouperSchema.by.key.and.type"><![CDATA[
    from GrouperSchema where 
      groupKey  = ?    and
      groupType = ?
  ]]></query>

  <query name="GrouperSession.by.id"><![CDATA[
    from GrouperSession where sessionID = ?
  ]]></query>

  <query name="GrouperType.all"><![CDATA[
    from GrouperType
  ]]></query>

  <query name="GrouperTypeDef.all"><![CDATA[
    from GrouperTypeDef
  ]]></query>

  <query name="SubjectImpl.by.subjectid.and.typeid"><![CDATA[
    from SubjectImpl     where
      subjectID     = ?  and
      subjectTypeID = ?
  ]]></query>

  <query name="SubjectTypeImpl.all"><![CDATA[
    from SubjectTypeImpl
  ]]></query>

</hibernate-mapping>

